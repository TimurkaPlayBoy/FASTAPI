{% extends "base.html" %}

{% block title %}–ú–æ—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —ñ–≥–æ—Ä{% endblock %}

{% block content %}
<div class="container">
    <div class="welcome-container">
        <div class="hero-section">
            <h1>üéÆ –í—ñ—Ç–∞—î–º–æ, {{ user.username }}!</h1>
            <p class="text-muted">–¢—É—Ç –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤—Å—ñ —ñ–≥—Ä–∏, —è–∫—ñ –≤–∏ –¥–æ–¥–∞–ª–∏ –¥–æ —Å–≤–æ—î—ó –∫–æ–ª–µ–∫—Ü—ñ—ó</p>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ—ó –≥—Ä–∏ -->
        <div class="auth-card" style="margin-bottom: 2rem;">
            <h3><i class="fas fa-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –≥—Ä—É –¥–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏</h3>
            <form action="/games/add" method="post" class="game-form">
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label>–ù–∞–∑–≤–∞ –≥—Ä–∏ *</label>
                        <input type="text" name="title" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: The Witcher 3: Wild Hunt" required>
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label>–ñ–∞–Ω—Ä</label>
                        <input type="text" name="genre" placeholder="RPG, Action, Strategy">
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label>–†—ñ–∫ –≤–∏–ø—É—Å–∫—É</label>
                        <input type="number" name="year" placeholder="2023" min="1950" max="2030">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label>–°—Ç–∞—Ç—É—Å</label>
                        <select name="status">
                            <option value="–í –ø–ª–∞–Ω–∞—Ö">üìã –í –ø–ª–∞–Ω–∞—Ö</option>
                            <option value="–ì—Ä–∞—é">üéÆ –ó–∞—Ä–∞–∑ –≥—Ä–∞—é</option>
                            <option value="–ó–∞–≤–µ—Ä—à–µ–Ω–æ">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</option>
                        </select>
                    </div>

                    <div class="form-group" style="flex: 1;">
                        <label>–í–∞—à —Ä–µ–π—Ç–∏–Ω–≥ (0-10)</label>
                        <input type="number" name="rating" placeholder="0" min="0" max="10">
                    </div>

                    <div class="form-group" style="flex: 1; align-self: flex-end;">
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-save"></i> –î–æ–¥–∞—Ç–∏ –≥—Ä—É
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid" style="margin-bottom: 2rem;">
            <div class="stat-card">
                <div class="stat-value">{{ games|length }}</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ —ñ–≥–æ—Ä</div>
            </div>

            {% set completed_games = games|selectattr('status', 'equalto', '–ó–∞–≤–µ—Ä—à–µ–Ω–æ')|list %}
            <div class="stat-card">
                <div class="stat-value">{{ completed_games|length }}</div>
                <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
            </div>

            {% set playing_games = games|selectattr('status', 'equalto', '–ì—Ä–∞—é')|list %}
            <div class="stat-card">
                <div class="stat-value">{{ playing_games|length }}</div>
                <div class="stat-label">–ó–∞—Ä–∞–∑ –≥—Ä–∞—é</div>
            </div>

            {% set planned_games = games|selectattr('status', 'equalto', '–í –ø–ª–∞–Ω–∞—Ö')|list %}
            <div class="stat-card">
                <div class="stat-value">{{ planned_games|length }}</div>
                <div class="stat-label">–í –ø–ª–∞–Ω–∞—Ö</div>
            </div>
        </div>

        <!-- –°–ø–∏—Å–æ–∫ —ñ–≥–æ—Ä -->
        {% if games %}
        <div class="games-section">
            <h2><i class="fas fa-book"></i> –í–∞—à–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ —ñ–≥–æ—Ä</h2>

            <div class="game-grid">
                {% for game in games %}
                <div class="game-card">
                    <div class="game-header">
                        <h3 class="game-title">{{ game.title }}</h3>
                        <button class="delete-btn" onclick="deleteGame({{ game.id }})" title="–í–∏–¥–∞–ª–∏—Ç–∏">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>

                    <div class="game-meta">
                        {% if game.genre %}
                        <span><i class="fas fa-tag"></i> {{ game.genre }}</span>
                        {% endif %}

                        {% if game.year %}
                        <span><i class="fas fa-calendar"></i> {{ game.year }}</span>
                        {% endif %}

                        {% if game.rating and game.rating > 0 %}
                        <span class="rating">
                            <i class="fas fa-star" style="color: #fbbf24;"></i> {{ game.rating }}/10
                        </span>
                        {% endif %}
                    </div>

                    <div class="game-status">
                        <span class="status-badge status-{{ game.status|lower|replace(' ', '') }}">
                            {% if game.status == '–í –ø–ª–∞–Ω–∞—Ö' %}
                            üìã {{ game.status }}
                            {% elif game.status == '–ì—Ä–∞—é' %}
                            üéÆ {{ game.status }}
                            {% else %}
                            ‚úÖ {{ game.status }}
                            {% endif %}
                        </span>
                    </div>

                    <div class="game-footer">
                        <small><i class="fas fa-clock"></i> –î–æ–¥–∞–Ω–æ {{ game.created_at.strftime('%d.%m.%Y') }}</small>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="auth-card" style="text-align: center; padding: 3rem;">
            <i class="fas fa-gamepad" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
            <h3>–í–∞—à–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ –ø–æ—Ä–æ–∂–Ω—è</h3>
            <p class="text-muted">–î–æ–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä—à—É –≥—Ä—É, —â–æ–± –ø–æ—á–∞—Ç–∏ –∫–æ–ª–µ–∫—Ü—ñ—é!</p>
        </div>
        {% endif %}

        <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É -->
        <div style="text-align: center; margin-top: 2rem;">
            <a href="/dashboard" class="btn-primary">
                <i class="fas fa-chart-bar"></i> –î–µ—Ç–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            </a>
        </div>
    </div>
</div>

<script>
function deleteGame(gameId) {
    if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –≥—Ä—É –∑ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏?')) {
        window.location.href = `/games/delete/${gameId}`;
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
document.addEventListener('DOMContentLoaded', () => {
    const cards = document.querySelectorAll('.game-card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
    });
});
</script>

<style>
.game-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-row {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
}

.form-row .form-group {
    margin-bottom: 0;
}

.games-section {
    margin-top: 2rem;
}

.rating {
    color: #fbbf24;
    font-weight: 600;
}
</style>
{% endblock %}